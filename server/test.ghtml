\include{/include/test-results}

\htmlhead{D AutoTester}{}{}{
  <link rel="stylesheet" href="tester.css" type="text/css" />
}

\if{\not{\get{runid}}}{
    error, missing runid parameter
    \exit
}
\if{
    \not{\op{\get{runid}}{V}}
}{
    error, invalid runid parameter: \htmlquote{\get{runid}}
    \exit
}

\href{Back}{index.ghtml}
<p>

\sqlexec{
    select id, start_time, end_time, platform, reporter_ip from test_runs where id=\sqlquote{\get{runid}}
}
\while{\sqlrow{id}{st}{et}{platform}{ip}}{
    Test Run: \get{id}<br>
    Start Time: \get{st}<br>
    End Time: \get{et}<br>
    Platform: \get{platform}<br>
    Reporter: \get{ip}<br>
}

<br>

\sqlexec{
    select id, name from test_types
}
\set{i}{1}
\while{\sqlrow{id}{name}}{
    \set{tt_\i}{\get{id}}
    \set{tt_name_\i}{\get{name}}
    \set{tt_id_\i}{}
    \set{tt_st_\i}{&nbsp;}
    \set{tt_et_\i}{&nbsp;}
    \set{tt_rc_\i}{&nbsp;}
    \inc{i}
}
\set{numtypes}{\i}

\sqlexec{
    select id, start_time, end_time, test_type_id, rc from test_data where test_run_id=\sqlquote{\get{runid}}
}
\while{\sqlrow{id}{st}{et}{ttid}{rc}}{
    \if{\get{id}}{\set{tt_id_\get{ttid}}{\get{id}}}
    \if{\get{st}}{\set{tt_st_\get{ttid}}{\get{st}}}
    \if{\get{et}}{\set{tt_et_\get{ttid}}{\get{et}}}
    \if{\get{rc}}{\set{tt_rc_\get{ttid}}{\get{rc}}}
}

<table class="run">
    <tr><th>Test</th><th>Start Time</th><th>End Time</th><th>Result Code</th><th>&nbsp;</th>

\set{getclass}{\quote{
   \if{\eq{\1}{0}}{pass}{\if{\eq{\1}{&nbsp;}}{unknown}{fail}}
}}

\set{i}{1}
\while{\op{\numtypes}{>}{\i}}{
    <tr>
    <td>\get{tt_name_\get{i}}</td>
    <td class="date">\get{tt_st_\get{i}}</td>
    <td class="date">\get{tt_et_\get{i}}</td>
    <td class="result_\getclass{\get{tt_rc_\get{i}}}">\get{tt_rc_\get{i}}</td>
    <td>\if{\ne{\get{tt_rc_\get{i}}}{&nbsp;}}{\href{Show Log}{test_data.ghtml?dataid=\get{tt_id_\get{i}}}}{&nbsp;}</td>
    </tr>

    \inc{i}
}

</table>

\htmlfoot

